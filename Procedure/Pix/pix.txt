DROP PROCEDURE IF EXISTS efetuar_pix;
DELIMITER //
CREATE PROCEDURE efetuar_pix(IN pIDCCCREDITO INT, IN pIDCCDEBITO INT,IN pValor DECIMAL, OUT pResultado INT)
BEGIN
DECLARE SaldoDebito DECIMAL;
DECLARE SaldoCredito DECIMAL;
SELECT SALDO INTO SaldoCredito FROM contacorrente WHERE IDCLIENTE = pIDCCCREDITO;
SELECT SALDO INTO SaldoDebito FROM contacorrente WHERE IDCLIENTE = pIDCCDEBITO;
IF SaldoDebito < pValor THEN
SET pResultado = 3;
ELSEIF pIDCCCREDITO = pIDCCDEBITO THEN
SET pResultado = 2;
ELSE
INSERT INTO pix(DTHORA, IDCCCREDITO, IDCCDEBITO, VALOR) VALUES (NOW(), pIDCCCREDITO, pIDCCDEBITO, pValor);
UPDATE contacorrente SET SALDO = SaldoCredito + pValor WHERE IDCLIENTE = pIDCCCREDITO;
UPDATE contacorrente SET SALDO = SaldoDebito - pValor WHERE IDCLIENTE = pIDCCDEBITO;
SET pResultado = 1;
END IF;
END//
DELIMITER ;